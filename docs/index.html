<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get Data Frame Representations of Elasticsearch Results • uptasticsearch</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Get Data Frame Representations of Elasticsearch Results">
<meta property="og:description" content="
    Elasticsearch is an open-source, distributed, document-based datastore
    (&lt;https://www.elastic.co/products/elasticsearch&gt;).
    It provides an HTTP API for querying the database and extracting datasets, but that
    API was not designed for common data science workflows like pulling large batches of
    records and normalizing those documents into a data frame that can be used as a training
    dataset for statistical models. uptasticsearch provides an interface for Elasticsearch
    that is explicitly designed to make these data science workflows easy and fun.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">uptasticsearch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0.9999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/FAQ.html">Frequently Asked Questions</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/uptake/uptasticsearch/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div id="uptasticsearch" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#uptasticsearch" class="anchor"></a>uptasticsearch</h1></div>

<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p><code>uptasticsearch</code> tackles the issue of getting data out of Elasticsearch and into a tabular format in R and Python. It should work for all versions of Elasticsearch from 1.0.0 onwards, but <a href="https://github.com/uptake/uptasticsearch/blob/main/CONTRIBUTING.md#gha">is not regularly tested against all of them</a>. If you run into a problem, please <a href="https://github.com/uptake/uptasticsearch/issues">open an issue</a>.</p>
</div>
</div>
<div id="table-of-contents" class="section level1">
<h1 class="hasAnchor">
<a href="#table-of-contents" class="anchor"></a>Table of contents</h1>
<ul>
<li><a href="#howitworks">How it Works</a></li>
<li>
<a href="#installation">Installation</a>
<ul>
<li><a href="#rinstallation">R</a></li>
<li><a href="#pythoninstallation">Python</a></li>
</ul>
</li>
<li>
<a href="#examples">Usage Examples</a>
<ul>
<li><a href="#example1">Get a Batch of Documents</a></li>
<li><a href="#example2">Aggregation Results</a></li>
</ul>
</li>
</ul>
<div id="how-it-works-" class="section level2">
<h2 class="hasAnchor">
<a href="#how-it-works-" class="anchor"></a>How it Works <a name="howitworks"></a>
</h2>
<p>The core functionality of this package is the <code><a href="reference/es_search.html">es_search()</a></code> function. This returns a <code>data.table</code> containing the parsed result of any given query. Note that this includes <code>aggs</code> queries.</p>
</div>
<div id="installation-" class="section level2">
<h2 class="hasAnchor">
<a href="#installation-" class="anchor"></a>Installation <a name="installation"></a>
</h2>
<div id="r-" class="section level3">
<h3 class="hasAnchor">
<a href="#r-" class="anchor"></a>R <a name="rinstallation"></a>
</h3>
<p><img src="https://img.shields.io/badge/lifecycle-maturing-blue.svg" alt="Lifecycle Maturing"></p>
<p>Releases of this package can be installed from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(
  <span class="st">'uptasticsearch'</span>
  , <span class="kw">repos</span> <span class="kw">=</span> <span class="st">"http://cran.rstudio.com"</span>
)</pre></div>
<p>or from <code>conda-forge</code></p>
<pre class="shell"><code>conda install -c conda-forge r-uptasticsearch</code></pre>
<p>To use the development version of the package, which has the newest changes, you can install directly from GitHub</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="kw pkg">remotes</span><span class="kw ns">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(
  <span class="st">"uptake/uptasticsearch"</span>
  , <span class="kw">subdir</span> <span class="kw">=</span> <span class="st">"r-pkg"</span>
)</pre></div>
</div>
<div id="python-" class="section level3">
<h3 class="hasAnchor">
<a href="#python-" class="anchor"></a>Python <a name="pythoninstallation"></a>
</h3>
<p><img src="https://img.shields.io/badge/lifecycle-dormant-orange.svg" alt="Lifecycle Dormant"></p>
<p>This package is not currently available on PyPi. To build the development version from source, clone this repo, then :</p>
<pre class="shell"><code>cd py-pkg
pip install .</code></pre>
</div>
</div>
<div id="usage-examples-" class="section level2">
<h2 class="hasAnchor">
<a href="#usage-examples-" class="anchor"></a>Usage Examples <a name="examples"></a>
</h2>
<p>The examples presented here pertain to a fictional Elasticsearch index holding some information on a movie theater business.</p>
<div id="example-1-get-a-batch-of-documents-" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1-get-a-batch-of-documents-" class="anchor"></a>Example 1: Get a Batch of Documents <a name="example1"></a>
</h3>
<p>The most common use case for this package will be the case where you have an Elasticsearch query and want to get a data frame representation of many resulting documents.</p>
<p>In the example below, we use <code>uptasticsearch</code> to look for all survey results in which customers said their satisfaction was “low” or “very low” and mentioned food in their comments.</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">uptasticsearch</span>)

<span class="co"># Build your query in an R string</span>
<span class="no">qbody</span> <span class="kw">&lt;-</span> <span class="st">'{
  "query": {
    "filtered": {
      "filter": {
        "bool": {
          "must": [
            {
              "exists": {
                "field": "customer_comments"
              }
            },
            {
              "terms": {
                "overall_satisfaction": ["very low", "low"]
              }
            }
          ]
        }
      }
    },
    "query": {
      "match_phrase": {
        "customer_comments": "food"
      }
    }
  }
}'</span>

<span class="co"># Execute the query, parse into a data.table</span>
<span class="no">commentDT</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/es_search.html">es_search</a></span>(
    <span class="kw">es_host</span> <span class="kw">=</span> <span class="st">'http://mydb.mycompany.com:9200'</span>
    , <span class="kw">es_index</span> <span class="kw">=</span> <span class="st">"survey_results"</span>
    , <span class="kw">query_body</span> <span class="kw">=</span> <span class="no">qbody</span>
    , <span class="kw">scroll</span> <span class="kw">=</span> <span class="st">"1m"</span>
    , <span class="kw">n_cores</span> <span class="kw">=</span> <span class="fl">4</span>
)</pre></div>
</div>
<div id="example-2-aggregation-results-" class="section level3">
<h3 class="hasAnchor">
<a href="#example-2-aggregation-results-" class="anchor"></a>Example 2: Aggregation Results <a name="example2"></a>
</h3>
<p>Elasticsearch ships with a rich set of aggregations for creating summarized views of your data. <code>uptasticsearch</code> has built-in support for these aggregations.</p>
<p>In the example below, we use <code>uptasticsearch</code> to create daily timeseries of summary statistics like total revenue and average payment amount.</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">uptasticsearch</span>)

<span class="co"># Build your query in an R string</span>
<span class="no">qbody</span> <span class="kw">&lt;-</span> <span class="st">'{
  "query": {
    "filtered": {
      "filter": {
        "bool": {
          "must": [
            {
              "exists": {
                "field": "pmt_amount"
              }
            }
          ]
        }
      }
    }
  },
  "aggs": {
    "timestamp": {
      "date_histogram": {
        "field": "timestamp",
        "interval": "day"
      },
      "aggs": {
        "revenue": {
          "extended_stats": {
            "field": "pmt_amount"
          }
        }
      }
    }
  },
  "size": 0
}'</span>

<span class="co"># Execute the query, parse result into a data.table</span>
<span class="no">revenueDT</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/es_search.html">es_search</a></span>(
    <span class="kw">es_host</span> <span class="kw">=</span> <span class="st">'http://mydb.mycompany.com:9200'</span>
    , <span class="kw">es_index</span> <span class="kw">=</span> <span class="st">"transactions"</span>
    , <span class="kw">size</span> <span class="kw">=</span> <span class="fl">1000</span>
    , <span class="kw">query_body</span> <span class="kw">=</span> <span class="no">qbody</span>
    , <span class="kw">n_cores</span> <span class="kw">=</span> <span class="fl">1</span>
)</pre></div>
<p>In the example above, we used the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-datehistogram-aggregation.html">date_histogram</a> and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-metrics-extendedstats-aggregation.html">extended_stats</a> aggregations. <code><a href="reference/es_search.html">es_search()</a></code> has built-in support for many other aggregations and combinations of aggregations, with more on the way. Please see the table below for the current status of the package. Note that names of the form “agg1 - agg2” refer to the ability to handled aggregations nested inside other aggregations.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Agg type</th>
<th align="center">R support?</th>
<th align="center">Python support?</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><a href="http://bit.ly/2sn5Qiw">“cardinality”</a></td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left"><a href="http://bit.ly/2qIR97Z">“date_histogram”</a></td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left">date_histogram - cardinality</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left">date_histogram - extended_stats</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left">date_histogram - histogram</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left">date_histogram - percentiles</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left">date_histogram - significant_terms</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left">date_histogram - stats</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left">date_histogram - terms</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left"><a href="http://bit.ly/2qKqsDU">“extended_stats”</a></td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left"><a href="http://bit.ly/2sn4LXF">“histogram”</a></td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left"><a href="http://bit.ly/2sy4z7f">“percentiles”</a></td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left"><a href="http://bit.ly/1KnhT1r">“significant terms”</a></td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left"><a href="http://bit.ly/2sn1t74">“stats”</a></td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left"><a href="http://bit.ly/2mJyQ0C">“terms”</a></td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left">terms - cardinality</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left">terms - date_histogram</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left">terms - date_histogram - cardinality</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left">terms - date_histogram - extended_stats</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left">terms - date_histogram - histogram</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left">terms - date_histogram - percentiles</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left">terms - date_histogram - significant_terms</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left">terms - date_histogram - stats</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left">terms - date_histogram - terms</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left">terms - extended_stats</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left">terms - histogram</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left">terms - percentiles</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left">terms - significant_terms</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="odd">
<td align="left">terms - stats</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
<tr class="even">
<td align="left">terms - terms</td>
<td align="center">YES</td>
<td align="center">NO</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=uptasticsearch">https://​cloud.r-project.org/​package=uptasticsearch</a>
</li>
<li>Browse source code at <br><a href="https://github.com/uptake/uptasticsearch/">https://​github.com/​uptake/​uptasticsearch/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/uptake/uptasticsearch/issues">https://​github.com/​uptake/​uptasticsearch/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/BSD-3-Clause">BSD_3_clause</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>James Lamb <br><small class="roles"> Author, maintainer </small>  </li>
<li>Nick Paras <br><small class="roles"> Author </small>  </li>
<li>Austin Dickey <br><small class="roles"> Author </small>  </li>
<li><a href="authors.html">All authors...</a></li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/uptake/uptasticsearch/actions"><img src="https://github.com/uptake/uptasticsearch/workflows/Tests/badge.svg?branch=master" alt="GitHub Actions Build Status"></a></li>
<li><a href="https://codecov.io/gh/uptake/uptasticsearch"><img src="https://codecov.io/gh/uptake/uptasticsearch/branch/master/graph/badge.svg" alt="codecov"></a></li>
<li><a href="https://cran.r-project.org/package=uptasticsearch"><img src="https://www.r-pkg.org/badges/version-last-release/uptasticsearch" alt="CRAN_Status_Badge"></a></li>
<li><a href="https://cran.r-project.org/package=uptasticsearch"><img src="https://cranlogs.r-pkg.org/badges/grand-total/uptasticsearch" alt="CRAN_Download_Badge"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by James Lamb, Nick Paras, Austin Dickey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
