<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Execute an Elasticsearch query and get a data.table — es_search • uptasticsearch</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Execute an Elasticsearch query and get a data.table — es_search" />
<meta property="og:description" content="Given a query and some optional parameters, es_search gets results
             from HTTP requests to Elasticsearch and returns a data.table
             representation of those results." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">uptasticsearch</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0.9999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/FAQ.html">Frequently Asked Questions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/uptake/uptasticsearch/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Execute an Elasticsearch query and get a data.table</h1>
    <small class="dont-index">Source: <a href='https://github.com/uptake/uptasticsearch/tree/main/r-pkg/R/es_search.R'><code>R/es_search.R</code></a></small>
    <div class="hidden name"><code>es_search.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Given a query and some optional parameters, <code>es_search</code> gets results
             from HTTP requests to Elasticsearch and returns a data.table
             representation of those results.</p>
    </div>

    <pre class="usage"><span class='fu'>es_search</span>(
  <span class='no'>es_host</span>,
  <span class='no'>es_index</span>,
  <span class='kw'>size</span> <span class='kw'>=</span> <span class='fl'>10000</span>,
  <span class='kw'>query_body</span> <span class='kw'>=</span> <span class='st'>"{}"</span>,
  <span class='kw'>scroll</span> <span class='kw'>=</span> <span class='st'>"5m"</span>,
  <span class='kw'>max_hits</span> <span class='kw'>=</span> <span class='fl'>Inf</span>,
  <span class='kw'>n_cores</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span>(<span class='kw pkg'>parallel</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/detectCores.html'>detectCores</a></span>()/<span class='fl'>2</span>),
  <span class='kw'>break_on_duplicates</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>ignore_scroll_restriction</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>intermediates_dir</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/getwd.html'>getwd</a></span>()
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>es_host</th>
      <td><p>A string identifying an Elasticsearch host. This should be of the form
<code>[transfer_protocol][hostname]:[port]</code>. For example, <code>'http://myindex.thing.com:9200'</code>.</p></td>
    </tr>
    <tr>
      <th>es_index</th>
      <td><p>The name of an Elasticsearch index to be queried. Note that passing
<code>NULL</code> is not supported. Technically, not passing an index
to Elasticsearch is legal and results in searching over all indexes.
To be sure that this very expensive query is not executed by accident,
uptasticsearch forbids this. If you want to execute a query over
all indexes in the cluster, set this argument to <code>"_all"</code>.</p></td>
    </tr>
    <tr>
      <th>size</th>
      <td><p>Number of records per page of results.
See <a href='https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-from-size.html'>Elasticsearch docs</a> for more.
Note that this will be reset to 0 if you submit a <code>query_body</code> with
an "aggs" request in it. Also see <code>max_hits</code>.</p></td>
    </tr>
    <tr>
      <th>query_body</th>
      <td><p>String with a valid Elasticsearch query. Default is an empty query.</p></td>
    </tr>
    <tr>
      <th>scroll</th>
      <td><p>How long should the scroll context be held open? This should be a
duration string like "1m" (for one minute) or "15s" (for 15 seconds).
The scroll context will be refreshed every time you ask Elasticsearch
for another record, so this parameter should just be the amount of
time you expect to pass between requests. See the
<a href='https://www.elastic.co/guide/en/elasticsearch/reference/current/search-request-scroll.html'>Elasticsearch scroll/pagination docs</a>
for more information.</p></td>
    </tr>
    <tr>
      <th>max_hits</th>
      <td><p>Integer. If specified, <code>es_search</code> will stop pulling data as soon
as it has pulled this many hits. Default is <code>Inf</code>, meaning that
all possible hits will be pulled.</p></td>
    </tr>
    <tr>
      <th>n_cores</th>
      <td><p>Number of cores to distribute fetching and processing over.</p></td>
    </tr>
    <tr>
      <th>break_on_duplicates</th>
      <td><p>Boolean, defaults to TRUE. <code>es_search</code> uses the size of the
final object it returns to check whether or not some data were lost
during the processing. If you have duplicates in the source data, you
will have to set this flag to FALSE and just trust that no data have
been lost. Sorry :( .</p></td>
    </tr>
    <tr>
      <th>ignore_scroll_restriction</th>
      <td><p>There is a cost associated with keeping an
Elasticsearch scroll context open. By default,
this function does not allow arguments to <code>scroll</code>
which exceed one hour. This is done to prevent
costly mistakes made by novice Elasticsearch users.
If you understand the cost of keeping the context
open for a long time and would like to pass a <code>scroll</code>
value longer than an hour, set <code>ignore_scroll_restriction</code>
to <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>intermediates_dir</th>
      <td><p>When scrolling over search results, this function writes
intermediate results to disk. By default, `es_search` will create a temporary
directory in whatever working directory the function is called from. If you
want to change this behavior, provide a path here. `es_search` will create
and write to a temporary directory under whatever path you provide.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p><a href='https://www.elastic.co/guide/en/elasticsearch/reference/6.x/search-request-scroll.html'>Elasticsearch 6 scrolling strategy</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {

<span class='co'>###=== Example 1: Get low-scoring food survey results ===###</span>

<span class='no'>query_body</span> <span class='kw'>&lt;-</span> <span class='st'>'{"query":{"filtered":{"filter":{"bool":{"must":[
               {"exists":{"field":"customer_comments"}},
               {"terms":{"overall_satisfaction":["very low","low"]}}]}}},
               "query":{"match_phrase":{"customer_comments":"food"}}}}'</span>

<span class='co'># Execute the query, parse into a data.table</span>
<span class='no'>commentDT</span> <span class='kw'>&lt;-</span> <span class='fu'>es_search</span>(<span class='kw'>es_host</span> <span class='kw'>=</span> <span class='st'>'http://mydb.mycompany.com:9200'</span>
                       , <span class='kw'>es_index</span> <span class='kw'>=</span> <span class='st'>"survey_results"</span>
                       , <span class='kw'>query_body</span> <span class='kw'>=</span> <span class='no'>query_body</span>
                       , <span class='kw'>scroll</span> <span class='kw'>=</span> <span class='st'>"1m"</span>
                       , <span class='kw'>n_cores</span> <span class='kw'>=</span> <span class='fl'>4</span>)

<span class='co'>###=== Example 2: Time series agg features ===###</span>

<span class='co'># Create query that will give you daily summary stats for revenue</span>
<span class='no'>query_body</span> <span class='kw'>&lt;-</span> <span class='st'>'{"query":{"filtered":{"filter":{"bool":{"must":[
               {"exists":{"field":"pmt_amount"}}]}}}},
               "aggs":{"timestamp":{"date_histogram":{"field":"timestamp","interval":"day"},
               "aggs":{"revenue":{"extended_stats":{"field":"pmt_amount"}}}}},"size":0}'</span>

<span class='co'># Execute the query and get the result</span>
<span class='no'>resultDT</span> <span class='kw'>&lt;-</span> <span class='fu'>es_search</span>(<span class='kw'>es_host</span> <span class='kw'>=</span> <span class='st'>"http://es.custdb.mycompany.com:9200"</span>
                      , <span class='kw'>es_index</span> <span class='kw'>=</span> <span class='st'>'ticket_sales'</span>
                      , <span class='kw'>query_body</span> <span class='kw'>=</span> <span class='no'>query_body</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by James Lamb, Nick Paras, Austin Dickey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


